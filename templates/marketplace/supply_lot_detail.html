{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ lot.item_text }} #{{ lot.lot_number }}{% endblock %}

{% block content %}
<h1>{{ lot.item_text }} #{{ lot.lot_number }}</h1>
<dl>
    <dt>{% trans "Status" %}</dt><dd><span class="status status-{{ lot.status }}">{{ lot.get_status_display }}</span></dd>
    <dt>{% trans "Category" %}</dt><dd>{{ lot.get_category_display|default:"-" }}</dd>
    <dt>{% trans "Quantity" %}</dt><dd>{{ lot.quantity_value|default:"-" }} {{ lot.get_quantity_unit_display }}</dd>
    <dt>{% trans "Available until" %}</dt><dd>{{ lot.available_until|date:"N j, Y" }}</dd>
    <dt>{% trans "Location" %}</dt><dd>{{ lot.location_country }}{% if lot.location_locality %}, {{ lot.location_locality }}{% endif %}{% if lot.location_region %}, {{ lot.location_region }}{% endif %}</dd>
    {% if lot.asking_price %}<dt>{% trans "Asking price" %}</dt><dd>{{ lot.asking_price }} / {{ lot.get_price_unit_display }}</dd>{% endif %}
    <dt>{% trans "Shipping scope" %}</dt><dd>{{ lot.get_shipping_scope_display }}</dd>
    <dt>{% trans "Matches" %}</dt><dd>{{ lot.match_count }}</dd>
    {% if lot.notes %}<dt>{% trans "Notes" %}</dt><dd>{{ lot.notes }}</dd>{% endif %}
</dl>

{% if matches %}
<section>
    <h2>{% trans "Matches" %} ({{ lot.match_count }})</h2>
    {% for match in matches %}
    <div class="match-card">
        <div class="match-card-details">
            <strong>{% trans "Looking for:" %} {{ match.demand_post.item_text }}</strong>
            <span class="tile-meta">{% trans "From:" %} {{ match.demand_post.created_by.display_name }}</span>
            {% if match.demand_post.quantity_value %}<span class="tile-meta">{{ match.demand_post.quantity_value }} {{ match.demand_post.get_quantity_unit_display }}</span>{% endif %}
            <span class="tile-meta">{{ match.demand_post.location_country }}{% if match.demand_post.location_locality %}, {{ match.demand_post.location_locality }}{% endif %}</span>
        </div>
        <a href="{% url 'marketplace:thread_detail' match.thread.pk %}" class="btn btn-secondary btn-small">{% trans "Message" %}</a>
    </div>
    {% endfor %}
</section>
{% endif %}

<div class="actions">
    {% if lot.status == "active" %}
    <form method="post" action="{% url 'marketplace:supply_lot_toggle' lot.pk %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">{% trans "Withdraw" %}</button>
    </form>
    {% elif lot.status == "withdrawn" %}
    <form method="post" action="{% url 'marketplace:supply_lot_toggle' lot.pk %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary">{% trans "Reactivate" %}</button>
    </form>
    {% endif %}
    {% if lot.status != "expired" %}
    <a href="{% url 'marketplace:supply_lot_edit' lot.pk %}" class="btn btn-secondary">{% trans "Edit" %}</a>
    {% endif %}
    <a href="{% url 'marketplace:supply_lot_list' %}" class="btn btn-secondary">{% trans "Back to list" %}</a>
</div>
{% endblock %}
