{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Matches" %}{% endblock %}

{% block content %}
<h1>{% trans "Your Matches" %}</h1>
{% if grouped_matches %}
{% for parent, matches in grouped_matches.items %}
<div class="match-group">
    <div class="match-group-header">
        {% if user.role == "buyer" %}
            {% trans "Looking for:" %} {{ parent.item_text }}
        {% else %}
            {{ parent.item_text }}
        {% endif %}
    </div>
    {% for match in matches %}
    <div class="match-card">
        <div class="match-card-details">
            {% if user.role == "buyer" %}
                <strong>{{ match.supply_lot.item_text }}</strong>
                {% if match.supply_lot.quantity_value %}<span class="tile-meta">{{ match.supply_lot.quantity_value }} {{ match.supply_lot.get_quantity_unit_display }}</span>{% endif %}
                <span class="tile-meta">{{ match.supply_lot.location_country }}{% if match.supply_lot.location_locality %}, {{ match.supply_lot.location_locality }}{% endif %}</span>
                {% if match.supply_lot.asking_price %}<span class="tile-meta">${{ match.supply_lot.asking_price }}/{{ match.supply_lot.get_price_unit_display }}</span>{% endif %}
                <span class="tile-meta">{{ match.supply_lot.get_shipping_scope_display }}</span>
            {% else %}
                <strong>{% trans "Looking for:" %} {{ match.demand_post.item_text }}</strong>
                {% if match.demand_post.quantity_value %}<span class="tile-meta">{{ match.demand_post.quantity_value }} {{ match.demand_post.get_quantity_unit_display }}</span>{% endif %}
                <span class="tile-meta">{{ match.demand_post.location_country }}{% if match.demand_post.location_locality %}, {{ match.demand_post.location_locality }}{% endif %}</span>
            {% endif %}
        </div>
        <a href="{% url 'marketplace:thread_detail' match.thread.pk %}" class="btn btn-secondary btn-small">{% trans "Message" %}</a>
    </div>
    {% endfor %}
</div>
{% endfor %}
{% else %}
<p class="empty-state">{% trans "No matches yet." %}</p>
{% endif %}
{% endblock %}
